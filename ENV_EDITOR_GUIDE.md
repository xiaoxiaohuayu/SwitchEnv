# 环境配置文件编辑器 - 完整使用指南

## 核心功能

环境配置文件编辑器是 SwitchEnv 中最强大的功能之一,支持:

✅ **直接编辑 Windows 系统环境变量** (注册表)
✅ **直接编辑 Windows 用户环境变量** (注册表)  
✅ **编辑 Shell 配置文件** (.bashrc, PowerShell Profile 等)
✅ **实时预览环境变量**
✅ **一键保存到系统**

## 三种编辑模式

### 模式 1: 配置文件

编辑系统 Shell 配置文件,如:
- PowerShell Profile (`.ps1`)
- Bash 配置 (`.bashrc`, `.bash_profile`)
- Zsh 配置 (`.zshrc`)

**适用场景:**
- 需要在 Shell 启动时自动设置环境变量
- 需要添加别名、函数等Shell脚本
- 跨平台配置管理

### 模式 2: 系统环境变量 ⭐

**直接编辑 Windows 系统级环境变量**

- 存储位置: 注册表 `HKEY_LOCAL_MACHINE\...\Environment`
- 权限要求: **需要管理员权限**
- 作用范围: 所有用户
- 实时生效: 保存后新程序立即生效

**适用场景:**
- 设置全局工具路径 (JAVA_HOME, PYTHON_HOME)
- 配置系统级 PATH
- 设置系统服务需要的环境变量

### 模式 3: 用户环境变量 ⭐⭐⭐ (推荐)

**直接编辑 Windows 用户级环境变量**

- 存储位置: 注册表 `HKEY_CURRENT_USER\Environment`
- 权限要求: **无需管理员权限**
- 作用范围: 当前用户
- 实时生效: 保存后新程序立即生效

**适用场景:**
- 个人开发配置 (API_KEY, DATABASE_URL)
- 用户级 PATH 设置
- 项目相关的环境变量

## 使用方法

### 步骤 1: 打开编辑器

1. 启动 SwitchEnv
2. 点击"环境配置文件编辑器"按钮
3. 编辑器打开,默认显示"用户环境变量"

### 步骤 2: 选择编辑模式

使用顶部的单选按钮切换模式:
- **配置文件** - 编辑 Shell 配置文件
- **系统环境变量** - 编辑系统级环境变量 (需要管理员)
- **用户环境变量** - 编辑用户级环境变量 (推荐)

### 步骤 3: 编辑内容

#### 格式规范

每行一个环境变量,格式: `KEY=VALUE`

```
# 示例
NODE_ENV=development
API_URL=https://api.example.com
DATABASE_URL=postgresql://localhost:5432/mydb
JAVA_HOME=C:\Program Files\Java\jdk-17
MY_PATH=C:\MyTools\bin
```

#### 支持的语法

- ✅ 空行会被忽略
- ✅ `#` 开头的注释会被忽略
- ✅ 值中可以包含 `=` 符号
- ✅ 支持多行值(Windows 环境变量不支持,但配置文件支持)

### 步骤 4: 实时预览

编辑器底部会实时显示:
- 检测到的环境变量数量
- 环境变量列表(可展开查看)

### 步骤 5: 保存更改

#### 保存到系统/用户环境变量

1. 编辑完成后,点击"保存更改"按钮
2. 确认对话框会显示:
   - 系统变量: "⚠️ 需要管理员权限"
   - 用户变量: "✅ 无需管理员权限"
3. 点击"保存"
4. 自动写入 Windows 注册表
5. 广播环境变量更改消息
6. 新打开的程序立即生效!

#### 保存到配置文件

1. 点击"保存更改"
2. 原文件自动备份 (文件名`.backup.时间戳`)
3. 写入新内容
4. 下次 Shell 启动时生效

## 实际使用案例

### 案例 1: 设置开发环境变量

**需求:** 为 Node.js 项目设置环境变量

**步骤:**
1. 打开编辑器
2. 选择"用户环境变量"模式
3. 添加内容:
   ```
   NODE_ENV=development
   API_URL=http://localhost:3000
   DB_HOST=localhost
   DB_PORT=5432
   DB_NAME=myapp_dev
   JWT_SECRET=your-secret-key
   ```
4. 点击"保存更改"
5. 立即生效!

**验证:**
```bash
# 打开新的命令行
echo %NODE_ENV%
# 输出: development
```

### 案例 2: 修改 JAVA_HOME

**需求:** 更新 JDK 版本

**步骤:**
1. 打开编辑器
2. 选择"系统环境变量"模式 (或用户环境变量)
3. 找到 `JAVA_HOME` 行
4. 修改为新路径:
   ```
   JAVA_HOME=C:\Program Files\Java\jdk-17
   ```
5. 保存(系统变量需要管理员权限)
6. 立即生效!

### 案例 3: 添加工具到 PATH

**需求:** 让自定义工具全局可用

**方式 A: 直接修改 PATH**
```
PATH=C:\Windows\system32;C:\Windows;C:\MyTools\bin
```

**方式 B: 创建独立变量** (推荐)
```
MY_TOOL_PATH=C:\MyTools\bin
```

然后在系统设置中把 `%MY_TOOL_PATH%` 添加到 PATH

### 案例 4: 批量导入环境变量

**需求:** 从项目的 `.env` 文件导入

**步骤:**
1. 复制 `.env` 文件内容
2. 打开 SwitchEnv 编辑器
3. 选择"用户环境变量"
4. 粘贴内容
5. 保存 - 全部变量立即添加到系统!

### 案例 5: 清理无用变量

**需求:** 删除卸载软件后遗留的环境变量

**步骤:**
1. 打开编辑器
2. 选择"用户环境变量"或"系统环境变量"
3. 删除不需要的行
4. 保存 - 环境变量从注册表中删除!

## 模式对比

| 特性 | 配置文件 | 系统环境变量 | 用户环境变量 |
|------|---------|------------|------------|
| 权限要求 | 无 | 管理员 | 无 |
| 生效时间 | Shell重启 | 立即 | 立即 |
| 作用范围 | Shell | 所有用户 | 当前用户 |
| 支持脚本 | ✅ | ❌ | ❌ |
| 跨平台 | ✅ | ❌ (仅Win) | ❌ (仅Win) |
| 备份机制 | ✅ | ❌ | ❌ |
| 推荐场景 | Shell配置 | 系统工具 | 个人开发 |

## 高级技巧

### 技巧 1: 批量操作

一次性添加多个环境变量:
```
API_KEY_DEV=dev_key_123
API_KEY_PROD=prod_key_456
API_KEY_TEST=test_key_789
DB_HOST_DEV=localhost
DB_HOST_PROD=prod.example.com
DB_HOST_TEST=test.example.com
```

保存后全部生效!

### 技巧 2: 值中包含特殊字符

```
# 包含空格
TOOL_PATH=C:\Program Files\MyTool\bin

# 包含等号
CONNECTION_STRING=Server=localhost;Database=mydb;User=sa;Password=123

# 包含分号 (PATH)
PATH=C:\Windows\system32;C:\Windows;C:\MyTools
```

### 技巧 3: 使用注释组织

```
# ========== 数据库配置 ==========
DB_HOST=localhost
DB_PORT=5432
DB_NAME=myapp

# ========== API配置 ==========
API_URL=https://api.example.com
API_KEY=your_api_key
API_TIMEOUT=30000

# ========== 开发工具 ==========
JAVA_HOME=C:\Program Files\Java\jdk-17
NODE_HOME=C:\Program Files\nodejs
```

### 技巧 4: 环境切换

在用户环境变量中设置:
```
CURRENT_ENV=development
```

然后在代码中读取 `process.env.CURRENT_ENV` 判断当前环境。

需要切换环境时,修改这一个变量即可!

## 注意事项

### ⚠️ 系统变量警告

1. **不要删除关键系统变量**
   - PATH, SYSTEM_ROOT, TEMP 等
   - 可能导致系统无法正常运行

2. **修改 PATH 要小心**
   - 确保保留所有现有路径
   - 建议在末尾添加新路径
   - 用分号分隔

3. **需要管理员权限**
   - 右键 SwitchEnv 图标
   - 选择"以管理员身份运行"

### 💡 用户变量建议

1. **优先使用用户变量**
   - 更安全
   - 无需管理员权限
   - 不影响其他用户

2. **变量命名规范**
   - 使用大写字母
   - 用下划线分隔: `MY_API_KEY`
   - 避免与系统变量冲突

3. **定期清理**
   - 删除不再使用的变量
   - 保持环境变量整洁

### 🔄 生效机制

**立即生效:**
- 新打开的命令行
- 新启动的应用程序

**需要重启:**
- 已运行的应用程序
- 某些系统服务
- 极端情况需重启电脑

## 故障排除

### 问题 1: 保存失败

**错误:** "保存失败,请检查权限"

**解决:**
- 系统变量: 以管理员身份运行 SwitchEnv
- 用户变量: 检查是否有其他程序正在修改环境变量

### 问题 2: 变量不生效

**原因:** 已运行的程序不会自动刷新

**解决:**
- 重启命令行工具
- 重启应用程序
- 必要时重启系统

### 问题 3: 编辑器显示乱码

**原因:** 文件编码问题

**解决:**
- 确保使用 UTF-8 编码
- 重新加载文件

### 问题 4: 找不到配置文件

**原因:** 文件不存在

**解决:**
- 点击"创建 PS Profile"按钮
- 或使用"手动输入"指定路径

## 快捷键

- `Ctrl+A` - 全选
- `Ctrl+C` - 复制
- `Ctrl+V` - 粘贴
- `Ctrl+Z` - 撤销
- `Ctrl+Y` - 重做
- `Ctrl+F` - 查找 (浏览器内置)

## 与其他功能的配合

### 配合 SwitchEnv 配置

1. 在系统环境变量中设置基础变量
2. 在 SwitchEnv 配置中设置项目变量
3. 快速切换不同项目配置

### 配合导入导出

1. 从环境变量编辑器复制变量
2. 粘贴到 SwitchEnv 配置
3. 导出为 JSON 备份

### 配合模板功能

1. 创建常用环境变量模板
2. 在编辑器中批量设置
3. 保存到系统

## 最佳实践

1. **分层管理**
   - 系统变量: 全局工具 (JAVA_HOME, PYTHON_HOME)
   - 用户变量: 个人配置 (API_KEY, 项目路径)
   - SwitchEnv: 项目特定变量(快速切换)

2. **备份重要配置**
   - 定期导出环境变量
   - 保存为 JSON 或 .env 文件

3. **使用注释**
   - 添加说明性注释
   - 方便日后维护

4. **定期清理**
   - 删除不再使用的变量
   - 保持环境整洁

---

现在你可以像编辑文本文件一样轻松管理 Windows 环境变量了! 🚀
