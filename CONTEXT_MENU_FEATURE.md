# 右键菜单功能说明

## 功能概述

SwitchEnv 现在支持智能的右键上下文菜单,根据不同的场景显示不同的菜单项。

## 菜单功能

### 📝 在可编辑区域(输入框、文本框等)

右键点击可编辑区域时,会显示完整的编辑菜单:

- **撤销** (Ctrl+Z) - 撤销上一步操作
- **重做** (Ctrl+Y) - 重做被撤销的操作
- **剪切** (Ctrl+X) - 剪切选中文本
- **复制** (Ctrl+C) - 复制选中文本
- **粘贴** (Ctrl+V) - 粘贴剪贴板内容
- **删除** (Delete) - 删除选中文本
- **全选** (Ctrl+A) - 选中所有文本
- --- 分隔线 ---
- **刷新** (Ctrl+R) - 重新加载页面
- **强制重载** (Ctrl+Shift+R) - 清除缓存并重载

### 📄 在普通文本区域(已选中文本)

右键点击已选中的文本时:

- **复制** (Ctrl+C) - 复制选中文本
- --- 分隔线 ---
- **刷新** (Ctrl+R) - 重新加载页面
- **强制重载** (Ctrl+Shift+R) - 清除缓存并重载

### 🖱️ 在普通区域(未选中文本)

右键点击普通区域时:

- **刷新** (Ctrl+R) - 重新加载页面
- **强制重载** (Ctrl+Shift+R) - 清除缓存并重载

### 🛠️ 开发模式专属菜单

在开发模式下,还会额外显示:

- **开发者工具** (F12) - 打开 Chrome DevTools
- **检查元素** - 在 DevTools 中定位到右键点击的元素

## 快捷键

| 功能 | Windows/Linux | macOS |
|------|---------------|-------|
| 撤销 | Ctrl+Z | Cmd+Z |
| 重做 | Ctrl+Y | Cmd+Y |
| 剪切 | Ctrl+X | Cmd+X |
| 复制 | Ctrl+C | Cmd+C |
| 粘贴 | Ctrl+V | Cmd+V |
| 全选 | Ctrl+A | Cmd+A |
| 刷新 | Ctrl+R | Cmd+R |
| 强制重载 | Ctrl+Shift+R | Cmd+Shift+R |
| 开发者工具 | F12 | F12 |

## 功能说明

### 刷新 vs 强制重载

**刷新 (Ctrl+R)**
- 重新加载当前页面
- 使用浏览器缓存
- 适合查看刚做的小改动

**强制重载 (Ctrl+Shift+R)**
- 清除所有缓存并重载
- 从服务器重新获取所有资源
- 适合解决缓存导致的问题

### 开发者工具

**开发者工具 (F12)**
- 打开/关闭 Chrome DevTools
- 可以查看控制台、网络请求、元素结构等

**检查元素**
- 直接定位到右键点击的 DOM 元素
- 在 Elements 面板中高亮显示该元素
- 方便调试和查看样式

## 使用场景

### 场景1: 编辑环境变量时打错字

1. 在变量值输入框中右键点击
2. 选择"撤销"恢复之前的内容
3. 或使用快捷键 Ctrl+Z

### 场景2: 修改代码后想看效果

1. 在应用窗口任意位置右键点击
2. 选择"刷新"重新加载页面
3. 或直接按 Ctrl+R

### 场景3: 页面显示异常

1. 右键点击任意位置
2. 选择"强制重载"清除缓存
3. 等待页面完全重新加载

### 场景4: 开发调试

1. 右键点击有问题的元素
2. 选择"检查元素"
3. 在 DevTools 中查看该元素的样式和属性

## 技术实现

### 上下文菜单监听

```typescript
mainWindow.webContents.on('context-menu', (_event, params) => {
  // params 包含右键点击的上下文信息
  // - isEditable: 是否在可编辑区域
  // - selectionText: 选中的文本
  // - x, y: 点击位置坐标
})
```

### 智能菜单构建

根据 `params` 的不同属性,动态构建菜单项:

1. **可编辑区域**: 显示完整编辑菜单
2. **有选中文本**: 只显示复制
3. **普通区域**: 只显示刷新和重载
4. **开发模式**: 额外显示开发者工具

### 菜单角色 (Role)

使用 Electron 的内置 role,自动处理标准功能:

```typescript
{ role: 'undo', label: '撤销' }    // 自动处理撤销逻辑
{ role: 'copy', label: '复制' }    // 自动处理复制逻辑
{ role: 'paste', label: '粘贴' }   // 自动处理粘贴逻辑
```

## 注意事项

### 菜单语言

- 所有菜单项都使用中文标签
- 保持与应用界面语言一致

### 开发模式检测

```typescript
import { is } from '@electron-toolkit/utils'

if (is.dev) {
  // 只在开发模式下添加开发者工具菜单
}
```

### 菜单弹出位置

菜单会自动出现在鼠标右键点击的位置:

```typescript
const contextMenu = Menu.buildFromTemplate(contextMenuTemplate)
contextMenu.popup()  // 在鼠标位置弹出
```

## 相关代码

- 主要实现: [`src/main/index.ts`](./src/main/index.ts) 中的 `createWindow()` 函数
- 菜单监听: `mainWindow.webContents.on('context-menu', ...)`
- 开发模式判断: `is.dev`

## 更新日志

### v1.1.1 (2025-11-22)

- ✨ 新增智能右键菜单
- ✨ 支持编辑区域完整菜单
- ✨ 新增刷新和强制重载功能
- ✨ 开发模式下显示开发者工具
- 🎨 菜单项全部中文化
- ⚡ 支持快捷键操作

## 常见问题

### Q: 为什么有时候右键菜单项不一样?

A: 菜单会根据你右键点击的位置智能调整。在输入框中显示编辑菜单,在普通区域显示刷新菜单。

### Q: 刷新后数据会丢失吗?

A: 不会!SwitchEnv 的所有数据都保存在本地文件中,刷新只是重新加载界面,不会影响已保存的配置。

### Q: 开发者工具菜单在哪里?

A: 只有在开发模式下(`pnpm run dev`)才会显示开发者工具菜单。打包后的生产版本不会显示。

### Q: 如何自定义右键菜单?

A: 可以修改 `src/main/index.ts` 中的 `context-menu` 事件处理函数,添加或修改菜单项。

## 最佳实践

1. **日常使用**: 右键点击普通区域,使用"刷新"查看最新数据
2. **遇到问题**: 使用"强制重载"清除可能的缓存问题
3. **开发调试**: 使用"检查元素"快速定位DOM元素
4. **编辑文本**: 在输入框中使用右键菜单的撤销/重做功能

---

享受更便捷的右键操作体验! 🎉
